# MyClean 应用测试脚本集合

## 📁 目录结构

本目录包含了 MyClean 应用的完整测试套件，涵盖后端 API 测试、前端 UI 测试以及各种辅助工具。

## 🚀 快速开始

### 1. 验证设置（推荐首先运行）
```bash
C:\Python312\python.exe verify_setup.py
```

### 2. 安装测试依赖
```bash
C:\Python312\python.exe install_test_dependencies.py
```

### 3. 运行推荐测试
```bash
# 后端 API 测试（推荐首先运行）
C:\Python312\python.exe test_backend_only.py

# 简化版综合测试
C:\Python312\python.exe test_myclean_simple.py
```

## 📋 测试脚本说明

### 🔧 核心测试脚本

#### `test_backend_only.py` ⭐ **推荐**
- **功能**: 专门测试后端 API 功能
- **特点**: 最稳定、最全面的后端测试
- **测试内容**:
  - 健康检查 (`/api/health`)
  - 用户注册 (`/api/auth/register`)
  - 用户登录 (`/api/auth/login`)
  - 服务管理 (`/api/services`)
  - 订单管理 (`/api/orders`)
- **运行条件**: 仅需后端服务运行
- **预期结果**: 🎉 所有后端API测试通过！

#### `test_myclean_simple.py`
- **功能**: 简化版综合测试
- **特点**: 快速验证核心功能
- **测试内容**: 后端 API + 前端健康检查
- **运行条件**: 后端服务必须运行，前端可选
- **适用场景**: 快速验证应用状态

#### `test_frontend_ui.py`
- **功能**: 前端用户界面自动化测试
- **特点**: 使用 Selenium WebDriver 进行 UI 测试
- **测试内容**:
  - 页面导航测试
  - 用户注册表单
  - 用户登录表单
  - 服务页面浏览
- **运行条件**: 需要前端服务 + Chrome 浏览器
- **依赖**: selenium, webdriver-manager

#### `test_myclean_app.py`
- **功能**: 完整的前端和后端测试
- **特点**: 最全面的测试覆盖
- **测试内容**: 包含所有功能模块的测试
- **运行条件**: 前端和后端服务都必须运行
- **适用场景**: 完整的回归测试

#### `run_all_tests.py`
- **功能**: 综合测试套件管理器
- **特点**: 自动运行多个测试脚本并生成报告
- **功能**:
  - 自动检测服务状态
  - 批量运行测试
  - 生成详细测试报告
  - 保存测试结果到文件

### 🛠️ 辅助工具脚本

#### `install_test_dependencies.py`
- **功能**: 自动安装测试所需的 Python 依赖包
- **安装包**: requests, selenium, webdriver-manager
- **使用时机**: 首次运行测试前

#### `debug_backend.py`
- **功能**: 后端 API 调试工具
- **特点**: 快速诊断后端问题
- **测试项目**:
  - 健康检查
  - 服务列表获取
  - 用户注册测试
- **适用场景**: 后端出现问题时的快速诊断

#### `fix_database.py`
- **功能**: 数据库修复和重建工具
- **特点**: 解决数据库相关问题
- **功能**:
  - 删除旧数据库
  - 创建新的数据库结构
  - 插入初始测试数据
- **使用时机**: 数据库损坏或结构问题时

#### `check_database.py`
- **功能**: 数据库状态检查工具
- **特点**: 非破坏性检查
- **检查内容**:
  - 数据库连接状态
  - 表结构完整性
  - 数据记录统计
- **适用场景**: 验证数据库状态

#### `start_backend.py`
- **功能**: 后端服务启动辅助脚本
- **特点**: 简化后端启动流程
- **功能**: 自动切换到后端目录并启动服务

#### `verify_setup.py`
- **功能**: 验证测试环境设置
- **特点**: 检查所有文件是否正确配置
- **检查内容**:
  - 测试脚本完整性
  - 文档文件存在性
  - 后端文件可访问性
- **使用时机**: 首次设置后或遇到路径问题时

### 📄 配置文件

#### `test_requirements.txt`
- **功能**: 测试依赖包列表
- **内容**:
  ```
  requests>=2.31.0
  selenium>=4.15.0
  webdriver-manager>=4.0.0
  ```

## 📚 文档文件

### `README_测试说明.md`
- 详细的测试使用说明文档
- 包含完整的安装和使用指南
- 故障排除指南

### `测试结果报告.md`
- 完整的测试执行报告
- 测试结果统计和分析
- 问题解决记录

### `快速测试指南.md`
- 快速上手指南
- 一键测试命令
- 常见问题解答

## 🎯 测试覆盖功能

### ✅ 已完全测试的功能
- **用户管理**
  - 客户注册和登录
  - 服务提供者注册和登录
  - 密码哈希和验证

- **服务管理**
  - 服务列表获取 (6个服务类型)
  - 服务分类 (Flowers, Cleaning, Gifts)
  - 服务时长选项 (10个配置)
  - 价格计算和倍数处理

- **订单管理**
  - 订单创建和验证
  - 订单号生成
  - 价格计算
  - 时间处理
  - 订单状态管理

- **数据库操作**
  - CRUD 操作验证
  - 数据完整性检查
  - 关联查询测试

### ⏳ 需要前端服务的功能
- 用户界面交互测试
- 表单提交验证
- 页面导航测试
- 角色切换功能

## 🔧 环境要求

### 必需软件
- **Python 3.12** - 运行测试脚本
- **Chrome 浏览器** - 前端 UI 测试 (可选)

### 服务要求
- **后端服务**: http://localhost:8000 (必需)
- **前端服务**: http://localhost:5173 (UI测试需要)

### Python 依赖
- requests >= 2.31.0
- selenium >= 4.15.0 (UI测试)
- webdriver-manager >= 4.0.0 (UI测试)

## 🚨 故障排除

### 常见问题及解决方案

#### 1. 后端连接失败
```bash
# 检查后端服务状态
C:\Python312\python.exe debug_backend.py

# 如果数据库有问题，修复数据库
C:\Python312\python.exe fix_database.py
```

#### 2. 数据库错误 (500 Internal Server Error)
```bash
# 重建数据库
C:\Python312\python.exe fix_database.py

# 检查数据库状态
C:\Python312\python.exe check_database.py
```

#### 3. 依赖包缺失
```bash
# 重新安装依赖
C:\Python312\python.exe install_test_dependencies.py
```

#### 4. Chrome 浏览器问题
- 确保已安装 Chrome 浏览器
- 检查 ChromeDriver 是否正确安装
- 可以在测试脚本中启用无头模式

## 📊 测试执行记录

### 最近测试结果 ✅
```
[15:26:30] SUCCESS: 🎉 所有后端API测试通过！
✅ 测试完成：后端API功能正常！

测试统计:
- 总测试项: 5个主要功能模块
- 通过测试: 5/5 (100%)
- 失败测试: 0/5 (0%)
```

### 测试数据示例
- **用户**: 2个预置用户 + 动态生成测试用户
- **服务**: 6个服务类型 (Fresh Flowers $21.0, Dried Flowers $25.0, 等)
- **订单**: 动态生成测试订单
- **数据库**: 5个主要表，完整关联结构

## 🎉 使用建议

### 日常开发测试
1. **快速验证**: `test_backend_only.py`
2. **问题诊断**: `debug_backend.py`
3. **数据库问题**: `fix_database.py`

### 完整回归测试
1. **启动服务**: 后端 + 前端
2. **运行测试**: `run_all_tests.py`
3. **查看报告**: 检查生成的测试报告

### 首次使用
1. **验证设置**: `verify_setup.py`
2. **安装依赖**: `install_test_dependencies.py`
3. **修复数据库**: `fix_database.py`
4. **运行测试**: `test_backend_only.py`

## 📞 技术支持

如果遇到问题：
1. 查看 `快速测试指南.md` 获取快速解决方案
2. 查看 `README_测试说明.md` 获取详细说明
3. 查看 `测试结果报告.md` 了解已知问题和解决方案

---

**最后更新**: 2025-07-23
**测试状态**: ✅ 后端功能完全正常
**维护状态**: 🔄 持续维护中